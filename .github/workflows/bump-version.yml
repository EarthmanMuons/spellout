# This file is generated by .github/cue/ci_tool.cue; DO NOT EDIT!

name: bump-version
"on":
  workflow_dispatch:
    inputs:
      package:
        description: Cargo package
        required: true
        default: spellout
        type: choice
        options:
          - spellabet
          - spellout
      level:
        description: Bump level
        required: true
        type: choice
        options:
          - patch
          - minor
          - major
env:
  CARGO_INCREMENTAL: 0
  CARGO_TERM_COLOR: always
  RUST_BACKTRACE: 1
  RUSTFLAGS: -D warnings
jobs:
  prepareRelease:
    name: prepare release
    permissions:
      contents: write
      pull-requests: write
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source code
        uses: actions/checkout@8e5e7e5ab8b370d6c329ec480221332ada57f0ab
        with:
          ref: main
      - name: Install stable Rust toolchain
        uses: dtolnay/rust-toolchain@b44cb146d03e8d870c57ab64b80f04586349ca5d
        with:
          toolchain: stable
      - name: Cache dependencies
        uses: Swatinem/rust-cache@988c164c3d0e93c4dbab36aaf5bbeb77425b2894
        with:
          shared-key: stable-ubuntu-latest
        timeout-minutes: 5
      - name: Update cargo dependencies for package {{ inputs.package }}
        run: cargo update --package "{{ inputs.package }}"
      - name: Install cargo-release
        run: cargo install --locked cargo-release
      - name: Bump {{ inputs.package }} crate version
        run: cargo release version --execute --no-confirm --package "{{ inputs.package }}" "{{ inputs.level }}"
      - name: Perform pre-release replacements
        run: cargo release replace --execute --no-confirm --package "{{ inputs.package }}"
      - name: Check formatting
        uses: creyD/prettier_action@31355f8eef017f8aeba2e0bc09d8502b13dbbad1
        with:
          prettier_version: 2.8.8
          prettier_options: --color --prose-wrap always --write **/*.md
      - id: cpr
        name: Create pull request
        uses: peter-evans/create-pull-request@284f54f989303d2699d373481a0cfa13ad5a6666
        with:
          branch-suffix: short-commit-hash
          commit-message: '[{{ inputs.package }}] Prepare next {{ inputs.level }} release'
          title: '[{{ inputs.package }}] Prepare next {{ inputs.level }} release'
          body: |-
            This PR was auto-generated and ran the following commands:

            ```
            $ cargo update --package "{{ inputs.package }}"
            $ cargo install --locked cargo-release
            $ cargo release version --execute --no-confirm --package "{{ inputs.package }}" "{{ inputs.level }}"
            $ cargo release replace --execute --no-confirm --package "{{ inputs.package }}"
            $ prettier --prose-wrap always --write **/*.md
            ```

            Please review the submitted changes. After merging, the rebased commit will automatically be tagged and a draft release will be opened.
      - name: Annotate workflow run with PR URL
        run: 'echo "### Opened Pull Request: {{ steps.cpr.outputs.pull-request-url }}" >> "$GITHUB_STEP_SUMMARY"'
